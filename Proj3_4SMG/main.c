#include <reg51.h>
/*
0xc0,0xf9,0xa4,0xb0,0x99,0x92,0x82,0xf8,0x80,0x90,0x88,0x83,0xc6,0xa1,0x86,0x8e	 //共阳
0x3f,0x06,0x5b,0x4f,0x66,0x6d,0x7d,0x07,0x7f,0x6f,0x77,0x7c,0x39,0x5e,0x79,0x71	 //共阴
*/
code unsigned char Num_Data[] = {0xc0,0xf9,0xa4,0xb0,0x99,0x92,0x82,0xf8,0x80,0x90,0x88,0x83,0xc6,0xa1,0x86,0x8e};
code unsigned char Num_addr[] = {0xef, 0xdf, 0xbf, 0x7f};

void delay(unsigned int t)
{
	unsigned char k;
	while(t--)
	{
		for(k=0;k<200;k++);
	}
}

unsigned char display_4SMG(unsigned int num)
{
	unsigned char i, P1_temp;
	if(num>9999)	//4位数码管不能显示超过9999
	{
		return 0;
	}
	for(i=0;i<4;i++)
	{
		P1_temp = P1;
		P1 = P1&Num_addr[i];
		P2 = Num_Data[num%10];
		num = num/10;
		delay(3);
		P1 = P1_temp;
		P2 = 0xff;
	}
}

void main()
{
	while(1)
	{
		display_4SMG(1234);
	}
}

